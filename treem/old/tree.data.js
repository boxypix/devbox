// tree.data.js
// Данные "дерева метрик" + описания.
// Правило: один узел = одна метрика/группа. Узлы-группы тоже можно описывать (как смысл ветки).

const METRIC_TREE = {
  id: "root",
  code: "TREE",
  name: "Дерево метрик (B2C)",
  short:
    "Карта B2C-роста: ценность (NSM) → привлечение → первая польза → использование → удержание → деньги + качество + экономика.",
  why:
    "Дает общий язык для команды: где именно ломается рост (трафик, активация, продуктовый цикл, удержание, платежи, качество или экономика) и какие метрики связаны.",
  tags: ["framework", "b2c"],
  howImprove: [
    "Сформулируй NSM как измерение полученной ценности (не просто размер аудитории)",
    "На каждой ветке выбери 1–2 ведущие метрики (ранний сигнал) и 1–2 итоговые (результат)",
    "Сделай единые определения (что считаем установкой, активацией, платящим и т.д.) и период подсчета",
    "Смотри не среднее, а когорты: канал, страна, версия, paywall вариант, сегмент",
    "Свяжи метрики с рычагами: какой продуктовый/маркетинговый шаг реально может поднять показатель"
  ],
  pitfalls: [
    "Оптимизировать все сразу и получить конфликт метрик (например, push ↑, удержание ↓)",
    "Подменять ценность прокси-метриками (время в приложении, экраны, клики)",
    "Смешивать платный и органический трафик без разделения когорт",
    "Менять события/определения во время эксперимента и ломать сравнимость",
    "Принимать решения по маленьким выборкам без проверки объема и доверия"
  ],
  related: ["NSM", "D7", "LTV", "CAC"],
  children: [
    {
      id: "nsm",
      code: "NSM",
      name: "North Star Metric (NSM)",
      short:
        "Одна метрика, которая лучше всего показывает: пользователь регулярно получает ключевую пользу.",
      why:
        "NSM удерживает фокус на ценности. Если растут только прокси (трафик, сессии), а NSM нет — продукт не становится полезнее.",
      formula:
        "NSM = пользователи, совершившие core value event за период (например, за неделю)",
      tags: ["strategy", "value"],
      howImprove: [
        "Определи core value event (1–2 события максимум), которое нельзя 'накликать' без реальной пользы",
        "Сократи Time to Value (TTV): убери шаги до первой пользы, добавь дефолты/шаблоны/демо",
        "Повышай повторяемость core action (регулярные поводы и быстрый путь к действию)",
        "Улучшай удержание ключевых когорт (платка/органика/страны/версии) вместо среднего",
        "Следи за качеством (краши, лаги, ошибки), потому что оно напрямую убивает NSM"
      ],
      pitfalls: [
        "Выбрать NSM = DAU/MAU (размер, а не ценность)",
        "Выбрать vanity-метрику (легко накрутить, слабо связано с пользой)",
        "Не зафиксировать период и правило подсчета → метрика 'плавает'",
        "Сделать NSM слишком редкой/долгой (результат виден через месяцы)",
        "Менять core value event без миграции — тренды становятся несравнимыми"
      ],
      related: ["AHA", "TTV", "CoreActionFreq", "D7"]
    },

    {
      id: "acq",
      code: "ACQ",
      name: "Acquisition (Привлечение)",
      short: "Как люди находят продукт и доходят до установки (и иногда регистрации).",
      why:
        "Верх воронки задает масштаб. Но важно не только количество, а качество входящих пользователей — иначе ниже по воронке все провалится.",
      tags: ["growth", "marketing"],
      howImprove: [
        "Упакуй обещание: ASO/SEO, локализация, скриншоты/видео, понятный оффер",
        "Тестируй креативы и аудитории: 1 гипотеза = 1 тест, контролируй изменения",
        "Строй микс каналов (органика/платка/реферал/контент/PR), чтобы снизить зависимость",
        "Оценивай качество по когортам (D1/D7, активация, оплата), не только по CPI",
        "Отсекай сегменты с низким LTV/retention даже если они дешевые"
      ],
      pitfalls: [
        "Сравнивать каналы без когорт (разные пользователи, разное качество)",
        "Оптимизировать CPI в ущерб удержанию и оплатам (дешевый трафик = слабый LTV)",
        "Менять сразу креатив, аудиторию и событие оптимизации и не понимать, что сработало",
        "Считать установку победой, когда value и деньги не происходят",
        "Игнорировать влияние рейтинга/отзывов на органику"
      ],
      children: [
        {
          id: "impr",
          code: "Impressions",
          name: "Impressions / Reach",
          short: "Сколько раз вашу страницу или креатив увидели (охват и показы).",
          why:
            "Это масштаб верха воронки: без достаточного потока людей ниже нечего конвертировать и улучшать.",
          formula: "Impressions = количество показов рекламы или показов страницы в сторе",
          tags: ["top-funnel"],
          howImprove: [
            "Расширять источники: новые каналы, новые плейсменты, новые аудитории",
            "Поднимать видимость в сторе: ASO, подбор ключей, локализация",
            "Запускать партнерки/рефералы/контент/PR для органического охвата",
            "Следить за частотой (frequency) и выгоранием креативов"
          ],
          pitfalls: [
            "Рост показов без роста CTR и конверсии — просто шум",
            "Гнаться за показами в нерелевантной аудитории",
            "Не контролировать частоту и сжигать бюджет на одних и тех же"
          ],
          related: ["CTR", "CVR_Install"]
        },
        {
          id: "ctr",
          code: "CTR",
          name: "CTR (Click-through rate)",
          short: "Доля людей, которые кликнули после просмотра (клики / показы).",
          why: "Показывает, насколько сообщение и визуал попадают в ожидание аудитории.",
          formula: "CTR = клики / показы",
          tags: ["top-funnel"],
          howImprove: [
            "Тестировать оффер и месседж: боль → выгода → доказательство",
            "Уточнять аудиторию (сегменты по интересам/намерению/гео/устройствам)",
            "Усилить первый кадр (видео) или первый экран (баннер/скрин): сразу показывать результат",
            "Убирать когнитивную нагрузку: меньше текста, яснее один смысл",
            "Следить за частотой: CTR падает при выгорании креатива"
          ],
          pitfalls: [
            "Высокий CTR при низком install conversion rate — кликбейт или неверное ожидание",
            "Оптимизировать CTR ценой качества пользователей (ниже по воронке провал)",
            "Сравнивать CTR между разными плейсментами без учета контекста"
          ],
          related: ["CVR_Install", "CPI"]
        },
        {
          id: "cvr_install",
          code: "CVR_Install",
          name: "Install Conversion Rate",
          short: "Доля людей, которые установили после визита на страницу в сторе/лендинге.",
          why:
            "Показывает, насколько упаковка продукта (обещание, доказательства, доверие) убеждает установить.",
          formula: "Install conversion rate = установки / визиты на страницу",
          tags: ["store", "landing"],
          howImprove: [
            "Скриншоты и видео: показывать результат и сценарий, а не список функций",
            "Убрать несоответствие обещания и продукта (честный оффер = выше качество и меньше возвратов)",
            "Локализация текста и визуала под ключевые страны",
            "Социальное доказательство: рейтинг, отзывы, пресса, цифры (если честные)",
            "A/B тесты и контроль изменений: один фактор за раз"
          ],
          pitfalls: [
            "Менять страницу без теста и без учета сезона/канала",
            "Пытаться улучшить CVR за счет агрессивных обещаний — потом падают рейтинг и удержание",
            "Смешивать трафик разных источников и делать ложные выводы"
          ],
          related: ["Rating", "Reviews", "CPI"]
        },
        {
          id: "cpi",
          code: "CPI/CPA",
          name: "CPI / CPA",
          short:
            "Сколько стоит установка или целевое действие (оплата, регистрация, активация).",
          why:
            "Показывает эффективность закупки трафика. Но метрика полезна только вместе с качеством (retention/LTV).",
          formula: "CPI = расходы / установки; CPA = расходы / целевые действия",
          tags: ["unit-econ", "ads"],
          howImprove: [
            "Оптимизировать кампании на событие ближе к ценности (активация/оплата), а не только на install",
            "Отсекать сегменты и плейсменты с плохим качеством по когортам (D1/D7, paywall conversion)",
            "Прокачивать onboarding и активацию — это снижает CPA через рост конверсии",
            "Следить за выгоранием креативов и частотой",
            "Считать экономику: CAC, payback, LTV/CAC"
          ],
          pitfalls: [
            "Оптимизировать CPI без учета LTV и удержания",
            "Гнаться за дешевыми установками и получать пользователей, которые не активируются",
            "Менять событие оптимизации и креативы одновременно и терять управляемость эксперимента"
          ],
          related: ["LTV", "CAC", "Payback"]
        },
        {
          id: "channel_mix",
          code: "ChannelMix",
          name: "Channel Mix",
          short:
            "Распределение трафика по источникам: органика, платная реклама, рефералы, контент, PR.",
          why:
            "Диверсификация снижает риск: если один канал просел (цены, правила, сезон), рост не обрушится полностью.",
          tags: ["strategy"],
          howImprove: [
            "Растить органику через ASO, рейтинг, отзывы, контент",
            "Запускать рефералы/партнерства с понятной выгодой",
            "Строить контентный цикл (соцсети/SEO) как долгий актив",
            "Отдельно считать когорты по источникам и сравнивать качество (retention/LTV)",
            "Не допускать перекоса: заранее ставить лимиты доли на один канал"
          ],
          pitfalls: [
            "Смешивать органику и платку без разделения когорт",
            "Расти только на одном канале и зависеть от его цены/алгоритма",
            "Оценивать микс по объему, игнорируя качество пользователей"
          ],
          related: ["Impressions", "CPI/CPA"]
        }
      ]
    },

    {
      id: "act",
      code: "ACT",
      name: "Activation (Активация / First Value)",
      short: "Получил ли новичок первую реальную пользу (first value) и как быстро.",
      why:
        "Активация — точка, где продукт начинает приносить пользу. Если first value не случился, дальше не спасут ни пуши, ни paywall.",
      tags: ["onboarding", "aha"],
      howImprove: [
        "Сокращать Time to Value: меньше шагов до результата, больше дефолтов",
        "Убирать обязательную регистрацию до момента пользы (если возможно)",
        "Давать шаблоны, пресеты и быстрый старт вместо 'чистого листа'",
        "Показывать превью результата еще до настройки (демо ценности)",
        "Убирать фрикцию: сложные permissions, длинные формы, непонятные термины"
      ],
      pitfalls: [
        "Считать завершение онбординга вместо получения пользы",
        "Просить много данных и разрешений в первые секунды",
        "Делать first value слишком сложным (польза доступна только после длительной настройки)",
        "Не фиксировать окно X (минут/дней) и сравнивать несопоставимые значения"
      ],
      children: [
        {
          id: "aha",
          code: "AHA",
          name: "Activation Rate (Aha-rate)",
          short:
            "Доля новичков, которые сделали первое ценностное действие в первые X минут/дней.",
          why:
            "Это ранний индикатор здоровья продукта: если Aha низкий, рост будет 'дырявым' и монетизация станет токсичной.",
          formula: "Aha rate = новые пользователи с value event в X / все новые пользователи",
          tags: ["leading"],
          howImprove: [
            "Зафиксировать value event (что именно считаем 'первой пользой')",
            "Срезать шаги до value: меньше экранов, меньше выбора, больше дефолтов",
            "Показывать демо/превью результата до логина или до полной настройки",
            "Добавить подсказки just-in-time именно в момент шага к ценности",
            "Измерять по сегментам (канал, страна, версия) и чинить самые большие провалы"
          ],
          pitfalls: [
            "Выбрать value event, который не отражает пользу (или слишком легко накрутить)",
            "Считать Aha без окна X и получать несравнимые значения",
            "Поднимать Aha через навязчивые подсказки, которые ухудшают опыт",
            "Оптимизировать Aha и забыть про удержание (польза должна повторяться)"
          ],
          related: ["TTV", "D1", "OnboardingCompletion"]
        },
        {
          id: "ttv",
          code: "TTV",
          name: "Time to Value (TTV)",
          short: "Сколько времени проходит до первого полезного результата.",
          why:
            "Долгий путь до пользы повышает ранний отвал и снижает конверсию в оплату.",
          formula: "TTV = время value event − время первого запуска",
          tags: ["onboarding", "ux"],
          howImprove: [
            "Гостевой режим или быстрый старт без аккаунта (если возможно)",
            "Автозаполнение и умные дефолты вместо ручной настройки",
            "Шаблоны/пресеты и пример результата на первом экране",
            "Сдвинуть permissions на just-in-time момент, когда пользователь понимает выгоду",
            "Убирать лишние шаги: объяснения → в контекст, выбор → в минимум"
          ],
          pitfalls: [
            "Измерять время до регистрации, а не до пользы",
            "Считать TTV без определения value event",
            "Ускорять TTV ценой качества (польза формальная, но не реальная)"
          ],
          related: ["AHA", "D1"]
        },
        {
          id: "onb",
          code: "OnbCompletion",
          name: "Onboarding Completion",
          short: "Доля пользователей, которые дошли до конца онбординга.",
          why:
            "Это прокси трения на старте. Полезно диагностировать, но цель — не 'пройти онбординг', а получить first value.",
          formula: "Onboarding completion = завершили онбординг / новые пользователи",
          tags: ["proxy"],
          howImprove: [
            "Сократить количество шагов и обязательных полей",
            "Сделать прогрессивный онбординг: учить по мере использования",
            "Больше дефолтов и шаблонов вместо выбора 'с нуля'",
            "Убирать непонятные термины, добавлять примеры",
            "Смотреть drop-off по шагам и чинить самые 'дырявые'"
          ],
          pitfalls: [
            "Оптимизировать completion ценой качества (проходят, но пользы не получают)",
            "Считать completion как главный KPI и потерять фокус на Aha/TTV",
            "Добавлять шаги 'ради обучения', увеличивая трение"
          ],
          related: ["AHA", "TTV"]
        },
        {
          id: "perm",
          code: "OptIn",
          name: "Permission Opt-in Rate",
          short:
            "Доля пользователей, которые дали нужные разрешения (push, location, health и т.д.).",
          why:
            "Разрешения открывают ключевые сценарии и каналы коммуникации, но их легко 'убить' неправильным таймингом.",
          formula: "Opt-in rate = дали разрешение / увидели запрос",
          tags: ["push", "privacy"],
          howImprove: [
            "Просить just-in-time: в момент, когда пользователь видит выгоду",
            "Объяснять пользу конкретно (что получит и зачем), а не абстрактно",
            "Дать альтернативный путь без разрешения (ограниченный, но рабочий)",
            "Тестировать тексты прелоад-экрана перед системным запросом",
            "Не просить сразу несколько разрешений подряд"
          ],
          pitfalls: [
            "Просить разрешение в первые секунды без контекста",
            "Запрашивать все permissions сразу и получить массовый отказ",
            "Не иметь сценария без разрешения и терять пользователей",
            "Повторять запрос слишком часто и раздражать"
          ],
          related: ["PushOpenRate", "D7"]
        }
      ]
    },

    {
      id: "eng",
      code: "ENG",
      name: "Engagement (Использование)",
      short: "Насколько регулярно и осмысленно пользователи используют продукт.",
      why:
        "Engagement отражает повторяемость ценности: без регулярного использования удержание и деньги не удержатся.",
      tags: ["usage"],
      howImprove: [
        "Создавать поводы вернуться (циклы ценности, напоминания по делу, обновления контента)",
        "Персонализация: показывать релевантное и сокращать путь к главному сценарию",
        "Улучшать discoverability: точки входа, подсказки в контексте, хорошая навигация",
        "Сделать ключевое действие быстрым и доступным 'в один тап'",
        "Следить за качеством: лаги и краши режут engagement"
      ],
      pitfalls: [
        "Считать время в приложении успехом (может быть признаком фрустрации)",
        "Гнаться за количеством сессий без связи с core action",
        "Поднимать engagement спамом (пуши/баннеры) и портить удержание"
      ],
      children: [
        {
          id: "dau",
          code: "DAU/WAU/MAU",
          name: "DAU / WAU / MAU",
          short: "Сколько уникальных пользователей были активны за день, неделю или месяц.",
          why:
            "Это размер активной базы. Метрика полезна как итог, но сама по себе не объясняет, получают ли люди ценность.",
          formula: "DAU = уникальные пользователи с сессией за день (аналогично WAU/MAU)",
          tags: ["volume"],
          howImprove: [
            "Поднимать удержание через улучшение активации и продуктового цикла",
            "Давать регулярные поводы вернуться (контент, триггеры, привычки)",
            "Сегментировать и делать targeted win-back для ушедших",
            "Улучшать качество и скорость (особенно на старых девайсах)",
            "Связывать рост активных с NSM/core action"
          ],
          pitfalls: [
            "Рост DAU без роста NSM/core action — мнимая активность",
            "Накручивать активность уведомлениями и баннерами",
            "Сравнивать DAU между продуктами разных категорий без контекста"
          ],
          related: ["Stickiness", "CoreActionFreq"]
        },
        {
          id: "stick",
          code: "Stickiness",
          name: "Stickiness (DAU/MAU или WAU/MAU)",
          short: "Насколько часто пользователи возвращаются: DAU/MAU или WAU/MAU.",
          why:
            "Показывает частоту использования: продукт стал привычкой или решает редкую задачу.",
          formula: "Stickiness = DAU/MAU (или WAU/MAU)",
          tags: ["habit"],
          howImprove: [
            "Усилить регулярные сценарии и сделать их быстрыми",
            "Создать стабильный цикл ценности (польза → причина вернуться → новая польза)",
            "Добавить релевантные триггеры: уведомления/виджеты/почта только по делу",
            "Персонализировать вход: показывать 'следующий лучший шаг'",
            "Смотреть stickiness по сегментам (платящие vs бесплатные, каналы)"
          ],
          pitfalls: [
            "Сравнивать пороги stickiness между разными категориями продуктов",
            "Повышать stickiness спамом и ухудшать удержание/рейтинг",
            "Игнорировать core action: частые открытия без пользы"
          ],
          related: ["DAU/WAU/MAU", "Retention"]
        },
        {
          id: "sess_u",
          code: "SessionsPerUser",
          name: "Sessions per user",
          short: "Среднее количество сессий на активного пользователя за период.",
          why:
            "Прокси частоты использования. Важно смотреть вместе с core action, иначе можно стимулировать 'пустые' открытия.",
          formula: "Sessions per user = сессии / активные пользователи",
          tags: ["frequency"],
          howImprove: [
            "Упростить повторяемые задачи (быстрые действия, сохраненные настройки)",
            "Сделать ключевые сценарии быстрее (меньше шагов, меньше загрузок)",
            "Добавить понятные точки входа (виджеты, шорткаты, персональные карточки)",
            "Убирать баги и причины переоткрытий",
            "Сегментировать: новички и опытные пользователи имеют разную норму"
          ],
          pitfalls: [
            "Рост сессий из-за багов/фрустрации (переоткрывают, потому что не работает)",
            "Оптимизировать сессии, а не ценность (core action/NSM)",
            "Сравнивать сессии между продуктами разных типов без контекста"
          ],
          related: ["CoreActionFreq", "Latency"]
        },
        {
          id: "feat_adopt",
          code: "FeatureAdoption",
          name: "Feature Adoption",
          short: "Доля активных пользователей, которые реально используют конкретную функцию.",
          why:
            "Помогает понять, что приносит ценность, а что не работает/не найдено. Основа для приоритизации и удаления лишнего.",
          formula:
            "Feature adoption = пользователи, использовавшие фичу / активные пользователи",
          tags: ["feature"],
          howImprove: [
            "Улучшать discoverability: найти фичу должно быть легко",
            "Контекстные подсказки (в момент, когда фича решает задачу)",
            "Умные дефолты и автоподбор, чтобы фича работала сразу",
            "Связывать фичу с core value (не отдельный остров)",
            "Смотреть adoption по сегментам: новички vs power users"
          ],
          pitfalls: [
            "Давить подсказками/баннерами и портить UX",
            "Считать клики по кнопке 'попробовать' вместо реального использования",
            "Игнорировать качество: фича может быть найдена, но ломаться"
          ],
          related: ["AHA", "CoreActionFreq"]
        },
        {
          id: "core_freq",
          code: "CoreActionFreq",
          name: "Core Action Frequency",
          short: "Как часто пользователь совершает ключевое действие, которое приносит ценность.",
          why:
            "Это прямой драйвер NSM: частота core action показывает, насколько продукт встроен в жизнь пользователя.",
          formula:
            "Core action frequency = ключевые действия / активные пользователи (за неделю/месяц)",
          tags: ["value", "leading"],
          howImprove: [
            "Снизить трение в пути к действию (меньше шагов, быстрее загрузка)",
            "Сделать быстрые повторения (шорткаты, сохраненные настройки, пресеты)",
            "Персональные сценарии: показывать релевантное действие первым",
            "Добавить триггеры, которые ведут к действию, а не просто к открытию",
            "Проверять влияние на retention: частота должна вести к пользе, а не к зависимости"
          ],
          pitfalls: [
            "Выбрать неверное core action и оптимизировать шум",
            "Накручивать частоту механиками без ценности",
            "Игнорировать сегменты: у разных пользователей разная 'норма' частоты"
          ],
          related: ["NSM", "D7"]
        }
      ]
    },

    {
      id: "ret",
      code: "RET",
      name: "Retention (Удержание)",
      short: "Возвращаются ли пользователи после установки и остаются ли активными (по когортам).",
      why:
        "Retention — главный показатель продуктовой ценности во времени. Без него любой рост превращается в 'дырявое ведро'.",
      tags: ["cohorts"],
      howImprove: [
        "Поднимать activation (Aha, TTV) — это чаще всего самый сильный рычаг",
        "Находить топ-причины ухода (отзывы, саппорт, событийные логи) и закрывать их",
        "Строить продуктовый цикл: польза → причина вернуться → новая польза",
        "Win-back кампании по реальным триггерам, а не массовый спам",
        "Всегда смотреть retention по когортам: канал, страна, версия, paywall вариант"
      ],
      pitfalls: [
        "Смешивать когорты разных каналов и версий и получать 'среднюю температуру'",
        "Сравнивать retention без одинакового определения активности",
        "Поднимать удержание скидками/спамом и портить долгосрочную ценность",
        "Игнорировать качество (краши/лаг) как причину раннего оттока"
      ],
      children: [
        {
          id: "d1",
          code: "D1",
          name: "D1 Retention",
          short: "Доля пользователей, которые вернулись на следующий день после установки.",
          why:
            "Быстрая проверка, случилась ли первая польза и не было ли сильного разочарования/трения.",
          formula: "D1 retention = активны на day 1 / установили на day 0",
          tags: ["baseline"],
          howImprove: [
            "Сокращать TTV и доводить до first value быстрее",
            "Улучшать Aha: подсказки и дефолты в момент ценности",
            "Фиксить топ-краши и перфоманс на старых устройствах",
            "Убирать ранние блокеры (логин, paywall до ценности, сложные настройки)",
            "Сегментировать по каналу: иногда проблема не в продукте, а в обещании"
          ],
          pitfalls: [
            "Ранние пуши без ценности дают краткосрочные клики, но убивают доверие",
            "Считать D1 по смешанным когортам и скрывать проблему",
            "Гнаться за D1 через темные паттерны и ухудшать долгосрочный retention"
          ],
          related: ["AHA", "TTV", "CrashFree"]
        },
        {
          id: "d7",
          code: "D7",
          name: "D7 Retention",
          short: "Доля пользователей, которые активны на 7-й день после установки.",
          why:
            "Показывает, появилась ли регулярная польза и начал ли формироваться продуктовый цикл.",
          formula: "D7 retention = активны на day 7 / установили на day 0",
          tags: ["habit"],
          howImprove: [
            "Создавать регулярные поводы вернуться (контент, задачи, напоминания по делу)",
            "Персонализация: быстрее приводить к релевантному сценарию",
            "Строить циклы ценности: результат → следующий шаг → новый результат",
            "Улучшать core action frequency (частоту ключевого действия)",
            "Сегментировать: D7 сильно зависит от каналов и обещания"
          ],
          pitfalls: [
            "Сравнивать D7 между категориями продуктов без контекста",
            "Поднимать D7 за счет спама/скидок и портить качество",
            "Игнорировать качество и производительность как причину падения D7"
          ],
          related: ["Stickiness", "CoreActionFreq"]
        },
        {
          id: "d30",
          code: "D30",
          name: "D30 Retention",
          short: "Доля пользователей, которые активны на 30-й день после установки.",
          why:
            "Проверка долгосрочной ценности: продукт полезен, стабилен и монетизируется без боли.",
          formula: "D30 retention = активны на day 30 / установили на day 0",
          tags: ["long-term"],
          howImprove: [
            "Усилять продуктовый loop и повторяемость ключевых сценариев",
            "Снижать churn через устранение причин ухода (качество, UX, ожидания)",
            "Развивать roadmap вокруг реальной ценности (NSM), а не вокруг фич ради фич",
            "Делать монетизацию честной и понятной, снижать refunds",
            "Смотреть D30 по платящим и неплатящим отдельно"
          ],
          pitfalls: [
            "Держать людей только скидками/спамом (короткий эффект, затем падение)",
            "Игнорировать отток платящих (paid churn) отдельно от общего",
            "Считать D30 на слишком маленьких когортах и делать выводы"
          ],
          related: ["Churn", "LTV"]
        },
        {
          id: "cohort",
          code: "CohortRet",
          name: "Cohort Retention",
          short: "Удержание по когортам: канал, страна, версия, сегмент, paywall вариант.",
          why:
            "Позволяет увидеть, где именно ломается опыт или обещание. Средние цифры часто скрывают провалы отдельных когорт.",
          formula: "Retention по сегментам: {channel, country, app version, paywall variant}",
          tags: ["diagnostic"],
          howImprove: [
            "Чинить самые большие провалы по когортам (канал/страна/версия)",
            "Локализовать продукт/упаковку, если проблема только в конкретных странах",
            "Фиксить регрессии по версиям (release → падение retention)",
            "Проверять влияние paywall вариантов и тайминга",
            "Следить за объемом когорты и устойчивостью тренда"
          ],
          pitfalls: [
            "Мало данных → шум: делать выводы без объема",
            "Смешивать определения активности между сегментами",
            "Сравнивать когорты без учета сезонности и маркетинговых изменений"
          ],
          related: ["D7", "ChannelMix", "PaywallCVR"]
        },
        {
          id: "churn",
          code: "Churn",
          name: "Churn Rate",
          short: "Доля пользователей, которые 'ушли' и перестали быть активными за период.",
          why:
            "Показывает скорость утечки базы. Полезно для контроля здоровья продукта и эффекта win-back/улучшений.",
          formula:
            "Churn = ушедшие пользователи / users at start (определение зависит от продукта)",
          tags: ["loss"],
          howImprove: [
            "Зафиксировать определение активности (что значит 'ушел') и период",
            "Найти причины ухода: отзывы, саппорт, события, опросы",
            "Улучшать core value и повторяемость сценариев",
            "Фиксить качество и UX в местах, где чаще всего бросают",
            "Отдельно считать churn платящих (paid churn)"
          ],
          pitfalls: [
            "Разные определения активности → разные churn и несравнимые тренды",
            "Считать churn в среднем, игнорируя сегменты и версии",
            "Пытаться снизить churn скидками и спамом вместо улучшения ценности"
          ],
          related: ["D30", "WinBack"]
        },
        {
          id: "winback",
          code: "WinBack",
          name: "Re-activation / Win-back",
          short: "Доля пользователей, которые вернулись после периода неактивности.",
          why:
            "Часто самый дешевый способ роста: вернуть уже знакомого пользователя проще, чем привлечь нового.",
          formula: "Win-back = вернувшиеся / неактивные пользователи",
          tags: ["growth"],
          howImprove: [
            "Персональные кампании (по причине ухода или прошлому сценарию)",
            "Новые поводы вернуться: улучшения, новый контент, новые шаблоны",
            "Пуши/письма по реальному триггеру (когда есть ценность), а не массово",
            "Тестировать частоту и тайминг, чтобы не раздражать",
            "Измерять эффект по retention после возвращения, а не по кликам"
          ],
          pitfalls: [
            "Спамить 'вернись' без конкретной выгоды",
            "Оценивать win-back по opens/clicks, игнорируя дальнейшую активность",
            "Не исключать тех, кто удалил приложение/отказался от коммуникаций"
          ],
          related: ["PushOpenRate", "NSM"]
        }
      ]
    },

    {
      id: "mon",
      code: "MON",
      name: "Monetization (Монетизация)",
      short: "Как продукт превращает ценность в деньги: подписка, покупки, реклама.",
      why:
        "Монетизация должна усиливать ценность и поддерживать рост. Если она слишком ранняя или нечестная — падают активация, удержание и рейтинг.",
      tags: ["revenue"],
      howImprove: [
        "Показывать paywall после того, как пользователь понял ценность (timing)",
        "Сегментировать paywall: разные офферы для разных сценариев и когорт",
        "Упаковывать выгоды (jobs) вместо списка фич",
        "Продвигать годовые планы, бандлы и ясную экономию",
        "Следить за refunds и churn платящих: это часть монетизации"
      ],
      pitfalls: [
        "Давить paywall до value и убивать activation/retention",
        "Гнаться за конверсией и игнорировать refunds/chargebacks",
        "Использовать темные паттерны и получать падение рейтинга и доверия",
        "Считать монетизацию без когорт (разные каналы дают разный LTV)"
      ],
      children: [
        {
          id: "pay_cvr",
          code: "PaywallCVR",
          name: "Conversion to Paid",
          short: "Доля пользователей, которые оплатили (или перешли с trial на оплату).",
          why:
            "Ключевой рычаг выручки в подписке. Но важно смотреть вместе с удержанием платящих и возвратами.",
          formula: "Paywall conversion = оплатили / увидели paywall (или trial → paid)",
          tags: ["subscription"],
          howImprove: [
            "Показывать paywall после value (пользователь должен понимать, за что платит)",
            "Упаковывать выгоды и jobs, а не список фич",
            "Тестировать тайминг, оффер, цены и дизайн через A/B",
            "Сегментировать: новички vs активные, страны, каналы",
            "Следить за прозрачностью условий trial и отмены"
          ],
          pitfalls: [
            "Мерить только конверсию, игнорируя refunds и churn платящих",
            "Поднимать conversion через агрессию и получать падение рейтинга",
            "Сравнивать conversion без одинакового трафика и когорт",
            "Менять одновременно цену, текст и тайминг и терять понимание причины"
          ],
          related: ["ARPU", "RefundRate", "LTV"]
        },
        {
          id: "arpu",
          code: "ARPU/ARPPU",
          name: "ARPU / ARPPU",
          short: "Средний доход на пользователя (ARPU) и на платящего (ARPPU).",
          why:
            "Показывает эффективность монетизации и потенциал цены/упаковки. Важно смотреть в динамике и по когортам.",
          formula: "ARPU = выручка / активные пользователи; ARPPU = выручка / платящие",
          tags: ["pricing"],
          howImprove: [
            "Настроить тарифную сетку (месяц/год) и ясную экономию на годе",
            "Добавить апселлы и бандлы (если они усиливают ценность)",
            "Повышать paywall conversion и снижать refunds",
            "Оптимизировать цены по странам и сегментам (где это уместно)",
            "Смотреть ARPU вместе с retention и LTV"
          ],
          pitfalls: [
            "Поднимать ARPU ценой churn (короткий всплеск, потом падение)",
            "Сравнивать ARPU между каналами без учета когорт",
            "Игнорировать возвраты и комиссии при расчете",
            "Пытаться поднять ARPPU без роста ценности"
          ],
          related: ["LTV", "Payback"]
        },
        {
          id: "ltv",
          code: "LTV",
          name: "LTV (Lifetime Value)",
          short: "Сколько денег в среднем приносит пользователь за все время использования.",
          why:
            "LTV задает потолок расходов на рост (CAC) и помогает понять, можно ли масштабироваться устойчиво.",
          formula: "LTV ≈ ARPU × средняя длительность жизни (или модель по retention кривой)",
          tags: ["unit-econ"],
          howImprove: [
            "Повышать удержание и снижать churn (особенно платящих)",
            "Улучшать paywall conversion и честность оффера",
            "Снижать refunds/chargebacks через качество и ясные условия",
            "Считать LTV по когортам: канал, страна, версия, paywall вариант",
            "Учитывать маржинальность (комиссии, расходы на сервера, поддержку)"
          ],
          pitfalls: [
            "Считать LTV без когорт и без канала и получать ложную уверенность",
            "Использовать слишком короткое окно данных и переоценивать LTV",
            "Игнорировать time-to-payback и кэш-флоу",
            "Смешивать разовые покупки и подписку без нормализации"
          ],
          related: ["CAC", "LTV/CAC"]
        },
        {
          id: "refund",
          code: "RefundRate",
          name: "Refund / Chargeback Rate",
          short: "Доля возвратов и спорных списаний (chargebacks).",
          why:
            "Ранний сигнал проблем: несоответствие обещания, плохой UX оплаты, низкое качество или непонятные условия.",
          formula: "Refund rate = возвраты / покупки",
          tags: ["trust"],
          howImprove: [
            "Делать обещание на paywall честным и конкретным (что получу и когда)",
            "Понятный trial: сроки, автопродление, как отменить",
            "Фиксить качество и баги, из-за которых люди чувствуют обман",
            "Улучшать поддержку и FAQ по подписке",
            "Анализировать причины возвратов по отзывам/тикетам"
          ],
          pitfalls: [
            "Пытаться 'спрятать отмену' — удар по доверию и рейтингу",
            "Считать refunds общей цифрой без причин и сегментов",
            "Игнорировать chargebacks как более серьезный сигнал"
          ],
          related: ["Rating", "Reviews"]
        },
        {
          id: "mrr",
          code: "MRR/ARR",
          name: "Revenue / MRR / ARR",
          short: "Выручка и подписочная выручка в эквиваленте месяца/года (MRR/ARR).",
          why:
            "Показывает бизнес-результат и устойчивость дохода. Важно понимать, из чего складывается рост: новые, расширение, возвраты, отток.",
          formula: "MRR = сумма подписок в месячном эквиваленте",
          tags: ["business"],
          howImprove: [
            "Удержание платящих и снижение paid churn",
            "Продвижение годовых планов и ясной экономии",
            "Снижение refunds и улучшение качества",
            "Разобрать MRR на компоненты: new, expansion, churn, reactivation",
            "Сегментировать по странам/каналам, чтобы видеть где деньги"
          ],
          pitfalls: [
            "Расти MRR за счет скидок без удержания",
            "Считать MRR без учета возвратов и отмен",
            "Гнаться за выручкой, игнорируя маржу и CAC"
          ],
          related: ["PaywallCVR", "PaidChurn"]
        }
      ]
    },

    {
      id: "qual",
      code: "QUAL",
      name: "Quality & Reliability (Качество)",
      short: "Насколько продукт стабилен, быстрый и надежный для пользователя.",
      why:
        "Качество напрямую влияет на активацию, удержание и рейтинг. Даже хороший оффер не спасет, если продукт тормозит или падает.",
      tags: ["performance", "stability"],
      howImprove: [
        "Фиксить топ-краши по влиянию (какие экраны, какие когорты)",
        "Оптимизировать латентность ключевых экранов и p95, а не только среднее",
        "Добавить наблюдаемость: логирование, мониторинг, алерты",
        "Тестировать на средних/старых устройствах и плохой сети",
        "Использовать feature flags и постепенные раскатки для снижения риска"
      ],
      pitfalls: [
        "Игнорировать производительность на средних девайсах",
        "Оптимизировать только среднее время, игнорируя p95 'хвост боли'",
        "Считать качество вторичным и потом платить удержанием и рейтингом"
      ],
      children: [
        {
          id: "crashfree",
          code: "CrashFree",
          name: "Crash-free users/sessions",
          short: "Доля пользователей или сессий, которые прошли без краша.",
          why:
            "Краши моментально разрушают доверие и режут удержание, особенно у новичков.",
          formula: "Crash-free = 1 − (пользователи с крашем / активные пользователи)",
          tags: ["stability"],
          howImprove: [
            "Фиксить топ-краши по числу затронутых пользователей и по шагу воронки",
            "QA на ключевых девайсах и iOS/Android версиях, где больше всего крашей",
            "Использовать feature flags и постепенные раскатки",
            "Добавить сбор контекста (экран, событие, сеть) для быстрого дебага",
            "Контролировать регрессии после релизов"
          ],
          pitfalls: [
            "Смотреть только процент и игнорировать impact (какие экраны/когорты)",
            "Фиксить редкие краши вместо тех, что бьют по активации/оплатам",
            "Не отслеживать регрессии после обновлений"
          ],
          related: ["D1", "Rating"]
        },
        {
          id: "latency",
          code: "Latency",
          name: "Latency / Load time",
          short: "Скорость запуска и загрузки ключевых экранов/операций.",
          why:
            "Медленный продукт снижает конверсию и удержание. Скорость — это часть ценности.",
          formula: "Latency = p50/p95 время загрузки ключевых экранов",
          tags: ["performance"],
          howImprove: [
            "Кэширование и предзагрузка там, где это уместно",
            "Lazy load тяжелых частей и оптимизация изображений",
            "Скелетоны/плейсхолдеры, чтобы ожидание было понятным",
            "Оптимизация запросов и количества round-trips",
            "Смотреть p95 и сегменты (плохая сеть/старые девайсы)"
          ],
          pitfalls: [
            "Оптимизировать среднее, игнорируя p95 'хвост боли'",
            "Измерять только API и игнорировать UI (рендер, тяжелые списки)",
            "Ускорять за счет поломки корректности данных или UX"
          ],
          related: ["TTV", "SessionsPerUser"]
        },
        {
          id: "rating",
          code: "Rating",
          name: "Store Rating",
          short: "Средняя оценка приложения в сторе.",
          why:
            "Влияет на доверие и органические установки. Часто это внешний показатель качества и честности ожиданий.",
          formula: "Store rating = средняя оценка в App Store / Google Play",
          tags: ["store"],
          howImprove: [
            "Просить оценку после момента ценности (а не на первом запуске)",
            "Фиксить топ-проблемы, которые чаще всего упоминают",
            "Улучшать поддержку и понятный FAQ",
            "Снижать краши/лаги — это один из главных драйверов падения рейтинга",
            "Сегментировать отзывы по версиям: релиз → изменение рейтинга"
          ],
          pitfalls: [
            "Просить оценку слишком рано",
            "Стимулировать оценки нечестно и рисковать санкциями",
            "Игнорировать негативные отзывы и не закрывать причины"
          ],
          related: ["Reviews", "CVR_Install"]
        },
        {
          id: "reviews",
          code: "Reviews",
          name: "Reviews sentiment",
          short: "О чем пишут пользователи в отзывах: темы и тональность.",
          why:
            "Быстрый источник инсайтов и причин оттока. Плюс напрямую влияет на конверсию в установку.",
          formula: "Reviews = кластеры тем + тональность (вручную или автоматически)",
          tags: ["voice-of-customer"],
          howImprove: [
            "Кластеризовать отзывы по темам и версии приложения",
            "Быстро закрывать топ-боли, которые повторяются",
            "Отвечать на ключевые негативные отзывы (где можно помочь/объяснить)",
            "Сопоставлять темы отзывов с метриками (retention, краши, refunds)",
            "Использовать отзывы для формулировки гипотез и тестов"
          ],
          pitfalls: [
            "Реагировать на единичные отзывы без данных",
            "Исправлять не то: громкий кейс ≠ массовая проблема",
            "Не учитывать, что отзывы часто приходят после негативного опыта (смещение)"
          ],
          related: ["Rating", "RefundRate"]
        }
      ]
    },

    {
      id: "ue",
      code: "UE",
      name: "Unit Economics (Экономика)",
      short:
        "Связывает привлечение, удержание и монетизацию и отвечает: можно ли масштабироваться устойчиво.",
      why:
        "Если экономика не сходится (LTV/CAC, payback), рост превращается в сжигание денег даже при красивых метриках воронки.",
      tags: ["finance"],
      howImprove: [
        "Повышать LTV через удержание и честную монетизацию",
        "Снижать CAC через улучшение конверсий и качество трафика",
        "Ускорять payback (быстрее окупать привлечение)",
        "Считать экономику по когортам: канал, страна, paywall вариант",
        "Учитывать маржу, комиссии и возвраты"
      ],
      pitfalls: [
        "Считать экономику без когорт и без payback",
        "Оценивать CAC по установкам, а не по платящим/квалифицированным",
        "Переоценивать LTV на коротких данных",
        "Игнорировать маржинальность и возвраты"
      ],
      children: [
        {
          id: "cac",
          code: "CAC",
          name: "CAC (Customer Acquisition Cost)",
          short: "Сколько стоит привлечь платящего или квалифицированного пользователя.",
          why:
            "CAC задает лимит расходов на рост. Если CAC выше LTV или payback слишком длинный — масштабирование опасно.",
          formula:
            "CAC = расходы / привлеченные платящие (или квалифицированные пользователи)",
          tags: ["ads"],
          howImprove: [
            "Оптимизировать каналы по качеству (retention, paywall conversion), а не только по цене",
            "Повышать конверсию в оплату (paywall, оффер, тайминг)",
            "Сегментировать аудитории и отключать слабые когорты",
            "Улучшать onboarding/activation, чтобы больше пользователей доходили до ценности",
            "Считать CAC отдельно по странам и каналам"
          ],
          pitfalls: [
            "Считать CAC по установкам вместо платящих/квалифицированных",
            "Смешивать ретаргетинг и acquisition и получать искаженный CAC",
            "Игнорировать задержку конверсии (покупка может быть через дни/недели)"
          ],
          related: ["LTV", "Payback"]
        },
        {
          id: "ltvcac",
          code: "LTV/CAC",
          name: "LTV/CAC",
          short:
            "Соотношение LTV к CAC: сколько ценности вы получаете на каждый потраченный доллар/лари.",
          why:
            "Быстрый health-check экономики: показывает, можно ли масштабировать маркетинг без сжигания денег.",
          formula: "LTV/CAC = LTV / CAC",
          tags: ["health"],
          howImprove: [
            "Повышать удержание и LTV (особенно платящих)",
            "Улучшать прайс и упаковку ценности",
            "Снижать refunds и chargebacks",
            "Снижать CAC через повышение конверсий и улучшение качества трафика",
            "Считать по когортам, а не в среднем"
          ],
          pitfalls: [
            "Игнорировать время окупаемости (payback)",
            "Считать LTV/CAC на коротком окне и переоценивать LTV",
            "Смешивать каналы и сегменты и терять точность",
            "Игнорировать маржинальность (комиссии/затраты)"
          ],
          related: ["LTV", "CAC", "Payback"]
        },
        {
          id: "payback",
          code: "Payback",
          name: "Payback Period",
          short: "Сколько времени нужно, чтобы окупить стоимость привлечения (CAC).",
          why: "Даже при хорошем LTV длинный payback создает риск и давит на кэш-флоу.",
          formula: "Payback = время, пока накопленная маржа не станет ≥ CAC",
          tags: ["cashflow"],
          howImprove: [
            "Ранняя монетизация после value (не до) и понятные планы",
            "Продвигать годовые планы и предоплату, если это честно и уместно",
            "Снижать churn и повышать удержание платящих",
            "Снижать refunds и повышать качество, чтобы маржа была реальной",
            "Оптимизировать CAC и paywall conversion вместе"
          ],
          pitfalls: [
            "Окупаемость 'на бумаге' без учета refunds и комиссий",
            "Считать payback по среднему и игнорировать когорты",
            "Оптимизировать payback агрессивными условиями и терять доверие"
          ],
          related: ["RefundRate", "MRR/ARR"]
        }
      ]
    }
  ]
};

if (typeof globalThis !== "undefined") {
  globalThis.METRIC_TREE = METRIC_TREE;
}